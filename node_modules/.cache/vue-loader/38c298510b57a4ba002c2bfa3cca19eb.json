{"remainingRequest":"D:\\working\\Vue\\zuly\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\working\\Vue\\zuly\\src\\pages\\Live.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\working\\Vue\\zuly\\src\\pages\\Live.vue","mtime":1603565908718},{"path":"D:\\working\\Vue\\zuly\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\working\\Vue\\zuly\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\working\\Vue\\zuly\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\working\\Vue\\zuly\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgJ3dlYnJ0Yy1hZGFwdGVyJw0KaW1wb3J0IGlvIGZyb20gJ3NvY2tldC5pby1jbGllbnQnDQoNCnZhciBwY0NvbmZpZyA9IHsNCiAgJ2ljZVNlcnZlcnMnOiBbew0KICAgICd1cmxzJzogJ3N0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDInDQogIH0sDQogIHsNCiAgICAndXJscyc6ICd0dXJuOnp1bHkuaXQ6MzQ3OCcsDQogICAgJ2NyZWRlbnRpYWwnOiAndGVzdDEnLA0KICAgICd1c2VybmFtZSc6ICd0ZXN0MScNCiAgfV0NCn0NCg0KZXhwb3J0IGRlZmF1bHQgew0KICBkYXRhICgpIHsNCiAgICByZXR1cm4gew0KICAgICAgcHVibGljUGF0aDogcHJvY2Vzcy5lbnYuQkFTRV9VUkwsDQogICAgICBzdG9yZV9pZDogbnVsbCwNCiAgICAgIHNlc3Npb246ICcnLA0KICAgICAgbmFtZTogJ1Bhb2xvIEdyZXBwaScsDQogICAgICBpc0NoYW5uZWxSZWFkeTogZmFsc2UsDQogICAgICBpc0luaXRpYXRvcjogZmFsc2UsDQogICAgICBpc1N0YXJ0ZWQ6IGZhbHNlLA0KICAgICAgbG9jYWxTdHJlYW06IG51bGwsDQogICAgICBwYzogbnVsbCwNCiAgICAgIHNvY2tldDogbnVsbA0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHNlbmRNZXNzYWdlOiBmdW5jdGlvbiAobWVzc2FnZSkgew0KICAgICAgY29uc29sZS5sb2coJ0NsaWVudCBzZW5kaW5nIG1lc3NhZ2U6ICcsIG1lc3NhZ2UpDQogICAgICB0aGlzLnNvY2tldC5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSkNCiAgICB9LA0KICAgIGdvdFN0cmVhbTogZnVuY3Rpb24gKHN0cmVhbSkgew0KICAgICAgY29uc29sZS5sb2coJ0FkZGluZyBsb2NhbCBzdHJlYW0uJykNCiAgICAgIHRoaXMubG9jYWxTdHJlYW0gPSBzdHJlYW0NCiAgICAgIHZhciBsb2NhbFZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvY2FsVmlkZW8nKQ0KICAgICAgbG9jYWxWaWRlby5zcmNPYmplY3QgPSBzdHJlYW0NCiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ2dvdCB1c2VyIG1lZGlhJykNCiAgICAgIGlmICh0aGlzLmlzSW5pdGlhdG9yKSB7DQogICAgICAgIHRoaXMubWF5YmVTdGFydCgpDQogICAgICB9DQogICAgfSwNCiAgICBtYXliZVN0YXJ0OiBmdW5jdGlvbiAoKSB7DQogICAgICBjb25zb2xlLmxvZygnPj4+Pj4+PiBtYXliZVN0YXJ0KCkgJywgdGhpcy5pc1N0YXJ0ZWQsIHRoaXMubG9jYWxTdHJlYW0sIHRoaXMuaXNDaGFubmVsUmVhZHkpDQogICAgICBpZiAoIXRoaXMuaXNTdGFydGVkICYmIHR5cGVvZiB0aGlzLmxvY2FsU3RyZWFtICE9PSAndW5kZWZpbmVkJyAmJiB0aGlzLmlzQ2hhbm5lbFJlYWR5KSB7DQogICAgICAgIGNvbnNvbGUubG9nKCc+Pj4+Pj4gY3JlYXRpbmcgcGVlciBjb25uZWN0aW9uJykNCiAgICAgICAgdGhpcy5jcmVhdGVQZWVyQ29ubmVjdGlvbigpDQogICAgICAgIHRoaXMucGMuYWRkU3RyZWFtKHRoaXMubG9jYWxTdHJlYW0pDQogICAgICAgIHRoaXMuaXNTdGFydGVkID0gdHJ1ZQ0KICAgICAgICBjb25zb2xlLmxvZygnaXNJbml0aWF0b3InLCB0aGlzLmlzSW5pdGlhdG9yKQ0KICAgICAgICBpZiAodGhpcy5pc0luaXRpYXRvcikgew0KICAgICAgICAgIHRoaXMuZG9DYWxsKCkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgY3JlYXRlUGVlckNvbm5lY3Rpb246IGZ1bmN0aW9uICgpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMucGMgPSBuZXcgUlRDUGVlckNvbm5lY3Rpb24ocGNDb25maWcpDQogICAgICAgIHRoaXMucGMub25pY2VjYW5kaWRhdGUgPSB0aGlzLmhhbmRsZUljZUNhbmRpZGF0ZQ0KICAgICAgICB0aGlzLnBjLm9ucmVtb3Zlc3RyZWFtID0gdGhpcy5oYW5kbGVSZW1vdGVTdHJlYW1SZW1vdmVkDQogICAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGVkIFJUQ1BlZXJDb25ubmVjdGlvbicpDQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdGYWlsZWQgdG8gY3JlYXRlIFBlZXJDb25uZWN0aW9uLCBleGNlcHRpb246ICcgKyBlLm1lc3NhZ2UpDQogICAgICAgIGFsZXJ0KCdDYW5ub3QgY3JlYXRlIFJUQ1BlZXJDb25uZWN0aW9uIG9iamVjdC4nKQ0KICAgICAgfQ0KICAgIH0sDQogICAgaGFuZGxlSWNlQ2FuZGlkYXRlOiBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgIGNvbnNvbGUubG9nKCdpY2VjYW5kaWRhdGUgZXZlbnQ6ICcsIGV2ZW50KQ0KICAgICAgaWYgKGV2ZW50LmNhbmRpZGF0ZSkgew0KICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKHsNCiAgICAgICAgICB0eXBlOiAnY2FuZGlkYXRlJywNCiAgICAgICAgICBsYWJlbDogZXZlbnQuY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXgsDQogICAgICAgICAgaWQ6IGV2ZW50LmNhbmRpZGF0ZS5zZHBNaWQsDQogICAgICAgICAgY2FuZGlkYXRlOiBldmVudC5jYW5kaWRhdGUuY2FuZGlkYXRlDQogICAgICAgIH0pDQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb25zb2xlLmxvZygnRW5kIG9mIGNhbmRpZGF0ZXMuJykNCiAgICAgIH0NCiAgICB9LA0KICAgIGhhbmRsZUNyZWF0ZU9mZmVyRXJyb3I6IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZU9mZmVyKCkgZXJyb3I6ICcsIGV2ZW50KQ0KICAgIH0sDQogICAgZG9DYWxsOiBmdW5jdGlvbiAoKSB7DQogICAgICBjb25zb2xlLmxvZygnU2VuZGluZyBvZmZlciB0byBwZWVyJykNCiAgICAgIHRoaXMucGMuY3JlYXRlT2ZmZXIodGhpcy5zZXRMb2NhbEFuZFNlbmRNZXNzYWdlLCB0aGlzLmhhbmRsZUNyZWF0ZU9mZmVyRXJyb3IpDQogICAgfSwNCiAgICBzZXRMb2NhbEFuZFNlbmRNZXNzYWdlOiBmdW5jdGlvbiAoc2Vzc2lvbkRlc2NyaXB0aW9uKSB7DQogICAgICB0aGlzLnBjLnNldExvY2FsRGVzY3JpcHRpb24oc2Vzc2lvbkRlc2NyaXB0aW9uKQ0KICAgICAgY29uc29sZS5sb2coJ3NldExvY2FsQW5kU2VuZE1lc3NhZ2Ugc2VuZGluZyBtZXNzYWdlJywgc2Vzc2lvbkRlc2NyaXB0aW9uKQ0KICAgICAgdGhpcy5zZW5kTWVzc2FnZShzZXNzaW9uRGVzY3JpcHRpb24pDQogICAgfSwNCiAgICBoYW5kbGVSZW1vdGVTdHJlYW1SZW1vdmVkOiBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgIGNvbnNvbGUubG9nKCdSZW1vdGUgc3RyZWFtIHJlbW92ZWQuIEV2ZW50OiAnLCBldmVudCkNCiAgICB9LA0KICAgIGhhbmRsZVJlbW90ZUhhbmd1cDogZnVuY3Rpb24gKCkgew0KICAgICAgY29uc29sZS5sb2coJ1Nlc3Npb24gdGVybWluYXRlZC4nKQ0KICAgICAgdGhpcy5zdG9wKCkNCiAgICAgIHRoaXMuaXNJbml0aWF0b3IgPSBmYWxzZQ0KICAgIH0sDQogICAgc3RvcDogZnVuY3Rpb24gKCkgew0KICAgICAgdGhpcy5pc1N0YXJ0ZWQgPSBmYWxzZQ0KICAgICAgdGhpcy5wYy5jbG9zZSgpDQogICAgICB0aGlzLnBjID0gbnVsbA0KICAgIH0NCiAgfSwNCiAgbW91bnRlZDogZnVuY3Rpb24gKCkgew0KICAgIHRoaXMuc3RvcmVfaWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQNCiAgICB0aGlzLnNlc3Npb24gPSB0aGlzLiRyb3V0ZS5wYXJhbXMuY29udGFjdF9pZA0KDQogICAgdGhpcy5zb2NrZXQgPSBpby5jb25uZWN0KCkNCg0KICAgIGlmICh0aGlzLnNlc3Npb24gIT09ICcnKSB7DQogICAgICB0aGlzLnNvY2tldC5lbWl0KCdjcmVhdGUgb3Igam9pbicsIHRoaXMuc2Vzc2lvbikNCiAgICAgIGNvbnNvbGUubG9nKCdBdHRlbXB0ZWQgdG8gY3JlYXRlIG9yIGpvaW4gcm9vbTogJywgdGhpcy5zZXNzaW9uKQ0KICAgIH0NCg0KICAgIHRoaXMuc29ja2V0Lm9uKCdjcmVhdGVkJywgKHJvb20pID0+IHsNCiAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGVkIHJvb20gJyArIHJvb20pDQogICAgICB0aGlzLmlzSW5pdGlhdG9yID0gdHJ1ZQ0KICAgIH0pDQoNCiAgICB0aGlzLnNvY2tldC5vbignZnVsbCcsIChyb29tKSA9PiB7DQogICAgICBjb25zb2xlLmxvZygnUm9vbSAnICsgcm9vbSArICcgaXMgZnVsbCcpDQogICAgfSkNCg0KICAgIHRoaXMuc29ja2V0Lm9uKCdqb2luJywgKHJvb20pID0+IHsNCiAgICAgIGNvbnNvbGUubG9nKCdBbm90aGVyIHBlZXIgbWFkZSBhIHJlcXVlc3QgdG8gam9pbiByb29tICcgKyByb29tKQ0KICAgICAgY29uc29sZS5sb2coJ1RoaXMgcGVlciBpcyB0aGUgaW5pdGlhdG9yIG9mIHJvb20gJyArIHJvb20gKyAnIScpDQogICAgICB0aGlzLmlzQ2hhbm5lbFJlYWR5ID0gdHJ1ZQ0KICAgIH0pDQoNCiAgICB0aGlzLnNvY2tldC5vbignam9pbmVkJywgKHJvb20pID0+IHsNCiAgICAgIGNvbnNvbGUubG9nKCdqb2luZWQ6ICcgKyByb29tKQ0KICAgICAgdGhpcy5pc0NoYW5uZWxSZWFkeSA9IHRydWUNCiAgICB9KQ0KDQogICAgdGhpcy5zb2NrZXQub24oJ2xvZycsIChhcnJheSkgPT4gew0KICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJyYXkpDQogICAgfSkNCg0KICAgIC8vIFRoaXMgY2xpZW50IHJlY2VpdmVzIGEgbWVzc2FnZQ0KICAgIHRoaXMuc29ja2V0Lm9uKCdtZXNzYWdlJywgKG1lc3NhZ2UpID0+IHsNCiAgICAgIGNvbnNvbGUubG9nKCdDbGllbnQgcmVjZWl2ZWQgbWVzc2FnZTonLCBtZXNzYWdlKQ0KICAgICAgaWYgKG1lc3NhZ2UgPT09ICdnb3QgdXNlciBtZWRpYScpIHsNCiAgICAgICAgdGhpcy5tYXliZVN0YXJ0KCkNCiAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS50eXBlID09PSAnYW5zd2VyJyAmJiB0aGlzLmlzU3RhcnRlZCkgew0KICAgICAgICB0aGlzLnBjLnNldFJlbW90ZURlc2NyaXB0aW9uKG5ldyBSVENTZXNzaW9uRGVzY3JpcHRpb24obWVzc2FnZSkpDQogICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ2NhbmRpZGF0ZScgJiYgdGhpcy5pc1N0YXJ0ZWQpIHsNCiAgICAgICAgdmFyIGNhbmRpZGF0ZSA9IG5ldyBSVENJY2VDYW5kaWRhdGUoew0KICAgICAgICAgIHNkcE1MaW5lSW5kZXg6IG1lc3NhZ2UubGFiZWwsDQogICAgICAgICAgY2FuZGlkYXRlOiBtZXNzYWdlLmNhbmRpZGF0ZQ0KICAgICAgICB9KQ0KICAgICAgICB0aGlzLnBjLmFkZEljZUNhbmRpZGF0ZShjYW5kaWRhdGUpDQogICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UgPT09ICdieWUnICYmIHRoaXMuaXNTdGFydGVkKSB7DQogICAgICAgIHRoaXMuaGFuZGxlUmVtb3RlSGFuZ3VwKCkNCiAgICAgIH0NCiAgICB9KQ0KDQogICAgd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHsNCiAgICAgIGF1ZGlvOiBmYWxzZSwNCiAgICAgIHZpZGVvOiB0cnVlDQogICAgfSkNCiAgICAgIC50aGVuKHRoaXMuZ290U3RyZWFtKQ0KICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7DQogICAgICAgIGFsZXJ0KCdnZXRVc2VyTWVkaWEoKSBlcnJvcjogJyArIGUubmFtZSkNCiAgICAgIH0pDQoNCiAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSAoKSA9PiB7DQogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdieWUnKQ0KICAgIH0NCiAgfQ0KfQ0KDQo="},{"version":3,"sources":["Live.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Live.vue","sourceRoot":"src/pages","sourcesContent":["<template>\r\n  <div class=\"container mt-3\">\r\n    <small class=\"text-muted\">{{ $options.__file }}</small>\r\n    <h1 class=\"text-primary font-weight-bold\">\r\n      <router-link to=\"/\"><img src=\"~bootstrap-icons/icons/caret-left-fill.svg\" alt=\"caret icon\" width=\"30\" height=\"30\"></router-link>\r\n      Live-streaming con {{ name }}\r\n    </h1>\r\n    <p>Invia questo link a {{ name }}: <a target=\"_blank\" :href=\"'https://zuly.it/store/' + store_id + '/live/' + session\">https://zuly.it/store/{{ store_id }}/live/{{ session }}</a></p>\r\n    <div class=\"btn-group\" role=\"group\" aria-label=\"Invia live-streaming link\">\r\n      <a class=\"btn btn-secondary\" href=\"#\" role=\"button\"><img src=\"~bootstrap-icons/icons/telephone-outbound.svg\" alt=\"phone icon\" width=\"30\" height=\"30\"> Invia con un SMS</a>\r\n      <a class=\"btn btn-secondary\" href=\"#\" role=\"button\"><img :src=\"publicPath + 'WhatsApp.svg'\" alt=\"whatsapp icon\" width=\"30\" height=\"30\"> Invia con WhatsApp</a>\r\n      <a class=\"btn btn-secondary\" href=\"#\" role=\"button\"><img src=\"~bootstrap-icons/icons/envelope.svg\" alt=\"email icon\" width=\"30\" height=\"30\"> Invia tramite E-mail</a>\r\n    </div>\r\n    <hr>\r\n    <video id=\"localVideo\" autoplay muted playsinline class=\"mx-auto\"></video>\r\n    <button type=\"button\" class=\"btn btn-secondary btn-lg w-100 mt-3 mb-3\">Termina il live-streaming</button>\r\n    <button type=\"button\" class=\"btn btn-secondary btn-lg w-100 mt-3 mb-3\">Proposta di acquisto</button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport 'webrtc-adapter'\r\nimport io from 'socket.io-client'\r\n\r\nvar pcConfig = {\r\n  'iceServers': [{\r\n    'urls': 'stun:stun.l.google.com:19302'\r\n  },\r\n  {\r\n    'urls': 'turn:zuly.it:3478',\r\n    'credential': 'test1',\r\n    'username': 'test1'\r\n  }]\r\n}\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      publicPath: process.env.BASE_URL,\r\n      store_id: null,\r\n      session: '',\r\n      name: 'Paolo Greppi',\r\n      isChannelReady: false,\r\n      isInitiator: false,\r\n      isStarted: false,\r\n      localStream: null,\r\n      pc: null,\r\n      socket: null\r\n    }\r\n  },\r\n  methods: {\r\n    sendMessage: function (message) {\r\n      console.log('Client sending message: ', message)\r\n      this.socket.emit('message', message)\r\n    },\r\n    gotStream: function (stream) {\r\n      console.log('Adding local stream.')\r\n      this.localStream = stream\r\n      var localVideo = document.querySelector('#localVideo')\r\n      localVideo.srcObject = stream\r\n      this.sendMessage('got user media')\r\n      if (this.isInitiator) {\r\n        this.maybeStart()\r\n      }\r\n    },\r\n    maybeStart: function () {\r\n      console.log('>>>>>>> maybeStart() ', this.isStarted, this.localStream, this.isChannelReady)\r\n      if (!this.isStarted && typeof this.localStream !== 'undefined' && this.isChannelReady) {\r\n        console.log('>>>>>> creating peer connection')\r\n        this.createPeerConnection()\r\n        this.pc.addStream(this.localStream)\r\n        this.isStarted = true\r\n        console.log('isInitiator', this.isInitiator)\r\n        if (this.isInitiator) {\r\n          this.doCall()\r\n        }\r\n      }\r\n    },\r\n    createPeerConnection: function () {\r\n      try {\r\n        this.pc = new RTCPeerConnection(pcConfig)\r\n        this.pc.onicecandidate = this.handleIceCandidate\r\n        this.pc.onremovestream = this.handleRemoteStreamRemoved\r\n        console.log('Created RTCPeerConnnection')\r\n      } catch (e) {\r\n        console.log('Failed to create PeerConnection, exception: ' + e.message)\r\n        alert('Cannot create RTCPeerConnection object.')\r\n      }\r\n    },\r\n    handleIceCandidate: function (event) {\r\n      console.log('icecandidate event: ', event)\r\n      if (event.candidate) {\r\n        this.sendMessage({\r\n          type: 'candidate',\r\n          label: event.candidate.sdpMLineIndex,\r\n          id: event.candidate.sdpMid,\r\n          candidate: event.candidate.candidate\r\n        })\r\n      } else {\r\n        console.log('End of candidates.')\r\n      }\r\n    },\r\n    handleCreateOfferError: function (event) {\r\n      console.log('createOffer() error: ', event)\r\n    },\r\n    doCall: function () {\r\n      console.log('Sending offer to peer')\r\n      this.pc.createOffer(this.setLocalAndSendMessage, this.handleCreateOfferError)\r\n    },\r\n    setLocalAndSendMessage: function (sessionDescription) {\r\n      this.pc.setLocalDescription(sessionDescription)\r\n      console.log('setLocalAndSendMessage sending message', sessionDescription)\r\n      this.sendMessage(sessionDescription)\r\n    },\r\n    handleRemoteStreamRemoved: function (event) {\r\n      console.log('Remote stream removed. Event: ', event)\r\n    },\r\n    handleRemoteHangup: function () {\r\n      console.log('Session terminated.')\r\n      this.stop()\r\n      this.isInitiator = false\r\n    },\r\n    stop: function () {\r\n      this.isStarted = false\r\n      this.pc.close()\r\n      this.pc = null\r\n    }\r\n  },\r\n  mounted: function () {\r\n    this.store_id = this.$route.params.id\r\n    this.session = this.$route.params.contact_id\r\n\r\n    this.socket = io.connect()\r\n\r\n    if (this.session !== '') {\r\n      this.socket.emit('create or join', this.session)\r\n      console.log('Attempted to create or join room: ', this.session)\r\n    }\r\n\r\n    this.socket.on('created', (room) => {\r\n      console.log('Created room ' + room)\r\n      this.isInitiator = true\r\n    })\r\n\r\n    this.socket.on('full', (room) => {\r\n      console.log('Room ' + room + ' is full')\r\n    })\r\n\r\n    this.socket.on('join', (room) => {\r\n      console.log('Another peer made a request to join room ' + room)\r\n      console.log('This peer is the initiator of room ' + room + '!')\r\n      this.isChannelReady = true\r\n    })\r\n\r\n    this.socket.on('joined', (room) => {\r\n      console.log('joined: ' + room)\r\n      this.isChannelReady = true\r\n    })\r\n\r\n    this.socket.on('log', (array) => {\r\n      console.log.apply(console, array)\r\n    })\r\n\r\n    // This client receives a message\r\n    this.socket.on('message', (message) => {\r\n      console.log('Client received message:', message)\r\n      if (message === 'got user media') {\r\n        this.maybeStart()\r\n      } else if (message.type === 'answer' && this.isStarted) {\r\n        this.pc.setRemoteDescription(new RTCSessionDescription(message))\r\n      } else if (message.type === 'candidate' && this.isStarted) {\r\n        var candidate = new RTCIceCandidate({\r\n          sdpMLineIndex: message.label,\r\n          candidate: message.candidate\r\n        })\r\n        this.pc.addIceCandidate(candidate)\r\n      } else if (message === 'bye' && this.isStarted) {\r\n        this.handleRemoteHangup()\r\n      }\r\n    })\r\n\r\n    window.navigator.mediaDevices.getUserMedia({\r\n      audio: false,\r\n      video: true\r\n    })\r\n      .then(this.gotStream)\r\n      .catch(function (e) {\r\n        alert('getUserMedia() error: ' + e.name)\r\n      })\r\n\r\n    window.onbeforeunload = () => {\r\n      this.sendMessage('bye')\r\n    }\r\n  }\r\n}\r\n\r\n</script>"]}]}